<template>
    <div>
        <div class="pagebg sorts"></div>
        <div class="container">
            <h1 class="t_nav">
                <span>有些的时候，正是为了爱才悄悄躲开。躲开的是身影，躲不开的却是那份默默的情怀。</span>
                <a href="/" class="n1">网站首页</a>
                <a href="javascript:void(0);" class="n2">分类</a>
            </h1>
            <div class="sortBox">
                <div class="time">
                    <div class="block">
                        <div class="radio" style="margin-bottom:20px;">
                        </div>
                        <el-timeline :reverse="reverse">
                            <el-timeline-item v-for="(activity, index) in activities" hide-timestamp :key="index">
                <span
                        @click="clickTime(activity.content)"
                        :class="[activity.content == selectContent ? 'sortBoxSpan sortBoxSpanSelect' : 'sortBoxSpan']"
                >{{activity.content}}</span>
                            </el-timeline-item>
                        </el-timeline>
                    </div>
                </div>

                <div class="article">
                    <div class="block">
                        <el-timeline>
                            <el-timeline-item
                                    v-for="(item,index) in itemByDate"
                                    :key="index"
                                    :timestamp="item.createTime"
                                    placement="top"
                            >
                                <el-card>
                                    <h4 @click="goToList('blogContent', item.id)" class="itemTitle">{{item.title}}</h4>
                                    <br>
                                    <el-tag class="elTag" type="danger">{{item.flag}}</el-tag>

                                    <el-tag
                                            class="elTag"
                                            v-if="item.userName"
                                            @click="goToList('author', item.userName)"
                                    >{{item.userName}}
                                    </el-tag>

                                    <el-tag
                                            class="elTag"
                                            type="success"
                                            v-if="item.typeName"
                                            @click="goToList('blogSort', item.typeId)"
                                    >{{item.typeName}}
                                    </el-tag>

                                    <el-tag
                                            class="elTag"
                                            @click="goToList('tag', item.tagId)"
                                            v-for="(tagItem,index) in item.tagList"
                                            :key="index"
                                            v-if="item.tagList"
                                            type="warning"
                                    >{{tagItem.name}}
                                    </el-tag>
                                </el-card>
                            </el-timeline-item>
                        </el-timeline>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<script>
    import {getTagType, getArticleByBlogTag} from "@/api/tag";

    export default {
        data() {
            return {
                selectContent: "",
                reverse: true,
                activities: [],
                itemByDate: [],
                articleByDate: {}

            };
        },
        components: {
            //注册组件
        },
        mounted() {
        },
        created() {
            getTagType().then(response => {
                if (response.code == "20000") {
                    var activities = response.data;
                    let result = [];
                    for (let a = 0; a < activities.length; a++) {
                        let temp = activities[a].replace("年", "-").replace("月", "-") + "1";
                        let dataForDate = {content: activities[a], timestamp: temp};
                        result.push(dataForDate);
                    }
                    this.activities = result;
                    // 默认选择最后一个
                    this.clickTime(activities[activities.length - 1]);
                }
            })

        },
        methods: {
            clickTime(content) {
                this.selectContent = content;
                var params = new URLSearchParams();
                params.append("tagName", content);
                getArticleByBlogTag(params).then(response => {
                    if (response.code == "20000") {
                        this.itemByDate = response.data;
                    }
                });
            },
            //跳转到搜索详情页
            goToList(type, uid) {
                switch (type) {
                    case "tag": {
                        let routeData = this.$router.resolve({
                            path: "/list",
                            query: {tagUid: uid}
                        });
                        window.open(routeData.href, "_blank");
                    }
                        break;
                    case "blogSort": {
                        let routeData = this.$router.resolve({
                            path: "/list",
                            query: {sortUid: uid}
                        });
                        window.open(routeData.href, "_blank");
                    }
                        break;

                    case "author": {
                        let routeData = this.$router.resolve({
                            path: "/list",
                            query: {author: uid}
                        });
                        window.open(routeData.href, "_blank");
                    }
                        break;

                    case "blogContent": {
                        let routeData = this.$router.resolve({
                            path: "/info",
                            query: {blogUid: uid}
                        });
                        window.open(routeData.href, "_blank");
                    }
                        break;
                }
            },
            formatDate: function (time) {
                var date = new Date(time);
                var year = date.getFullYear();
                /* 在日期格式中，月份是从0开始的，因此要加0
                 * 使用三元表达式在小于10的前面加0，以达到格式统一  如 09:11:05
                 * */
                var month =
                    date.getMonth() + 1 < 10
                        ? "0" + (date.getMonth() + 1)
                        : date.getMonth() + 1;
                var day = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
                // 拼接
                return year + "-" + month + "-" + day;
            }
        }
    };
</script>


<style>
    .sortBox {
        color: #555;
    }

    .sortBoxSpan {
        cursor: pointer;
    }

    .sortBoxSpan:hover {
        color: #409eff;
    }

    .sortBoxSpanSelect {
        color: #409eff;
    }

    .itemTitle {
        cursor: pointer;
    }

    .itemTitle:hover {
        color: #409eff;
    }

    .elTag {
        cursor: pointer;
      margin-right: 10px;
    }
</style>
